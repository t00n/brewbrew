{% extends 'base.html' %}

{% block title %}Planning{% endblock %}

{% block content %}

<style type="text/css">
	th, td {
		min-width: 50px;
	}
</style>

<table id="planning" class="table table-bordered table-responsive">
	<tr>
		<th style="border-bottom: 0"></th>
		{% for date in dates %}
			{% if date.day == 1 %}
				<th style="border-right: 0">
					{{ date|date:"M" }}
				</th>
			{% else %}
				<th style="border-right: 0; border-left: 0"></th>
			{% endif %}
		{% endfor %}
	</tr>
	<tr>
		<th style="border-top: 0"></th>
		{% now 'Y-m-d' as today %}
		{% for date in dates %}
		<th class="{% if today == date|date:'Y-m-d' %}bg-dark{% endif %}">
			<center>{{ date.day }}</center>
		</th>
		{% endfor %}
	</tr>

	{% for tank, cells in tanks %}
	<tr>
		<th class="text-nowrap"><i class="fas fa-flask"></i>&nbsp;Tank {{ tank.name }}</th>
		{% for cell in cells %}
		<td colspan="{{ cell.duration }}" class="{% if cell.brew %}bg-warning{% endif %}">
			{% if cell.brew %}
			<center><a href="/admin/brewbrew/brew/{{ cell.brew.id }}/change">{{ cell.brew.batch_name }}</a></center>
			{% else %}
			<center>
		      <div class="dropdown dropdown-toggle"
		           type="button"
	               id="start-brewing-{{ tank.id }}-{{ cell.date }}"
	               data-toggle="dropdown"
	               aria-haspopup="true"
	               aria-expanded="false">
	            <i class="fas fa-beer"></i>
	          </div>
	          <div class="dropdown-menu" aria-labelledby="start-brewing-{{ tank.id }}-{{ cell.date }}">
	            {% for recipe in original_recipes %}
	              <a class="dropdown-item"
	              	 href="/recipes/{{ recipe.id }}/create_brew?tank_id={{ tank.id }}&start_date={{ cell.date.isoformat }}">
	                <b>{{ recipe.name }}</b>
	                &nbsp;
	                <em class="float-right">{{ recipe.total_duration }} days</em>
	              </a>
	            {% endfor %}
	          </div>
			</center>
			{% endif %}
		</td>
		{% endfor %}
	</tr>
	{% endfor %}
	
</table>

<script type="text/javascript">
	function scrollTableToday() {
		var t = document.getElementById("planning");
		t.scrollTo({{ today_ratio }} * t.scrollWidth - t.clientWidth / 2, 0);
	}
	window.onload = scrollTableToday
</script>

{% endblock %}